# Simulation

This directory contains the testbed used to explore the feasibility of the proposed implementation. 

It consists of a Mosaik Simulation, simulating a small electrical grid with two distinct subgrids. More information can be found in the testbed chapter of the master thesis. 

## Installation 

The testbed, which bases on the Mosaik Co-Simulation framework and different Mosaik simulators uses a lot of external dependencies, which need to be installed before the testbed can be used. 
In the following all necessary installation steps will be described. 

The three present directories, MosaikPyPower, PyModbus3 and Mosaik-Web need to by installed separatly beforehand. 
Use the command line to navigate into each of these folders and execute: 

    $ pip install -r requirements.txt
    $ python setup.py install 

After you have installed all three directories this way, navigate back to the testbed folder and execute: 

    $ pip install -r requirements.txt

During the development phase I faced multiple problems when installing the dependencies via the `requirements.txt` file and while using different Python version. 
I recommend to use Python 3.7 as it is compatible with all the used dependencies. 
If problems arise during the startup of the testbed (e.g. DB cannot be started) please try to uninstall the module and install it again e.g.: 

    $ pip uninstall mosaik-hdf5
    $ pip install mosaik-hdf5

### Comment about new MOSAIK 3.0.0 version

This testbed was originally developed with Mosaik Version 2.4.0 and later adapted for version 2.6.0. Thus, the results presented here and in the matching paper were developed with Mosaik 2.6.0. <br>
If you use Mosaik 3.0.0 anyway and run the test_scenario, deprecation warnings will be thrown. However, it (probably) will not the outcome of the results in a striking way.<br>
Future work will adapt this repository for Mosaik Version 3.0.0.<br>
Notice: Simpy must be version 3.0.10, since version 4.0.0 causes incompatibilities with Mosaik itself. 

## Start 

The proposed simulation for the testbed can be easily started via: 

    $ python test_scenario.py 

The simulation process then is started. The web visualization can be accessed at localhost:8000.<br>

If you want to save the output generated by the simulation, please start the helper file in another command line terminal with: 

    $ python client_connection.py

The generated outputs will be saved to the outputs folder. 

## Directory organisation 

### test_scenario
Simulation used within the test scenarios of the thesis. 

### client_connection.py 
Helper programm to save sensory readings produced during the simulation to readable CSV files for the monitoring system. 

### Data
This directory contains the configuration data. 

### Manipulation 
This directory contains exemplary files for online manipulation of the simulation. 

### Mosaik RTU 
This is a Mosaik Simulator representing an RTU, it was originally written by Chromik. 

### Mosaik PyPower
Libary to calculate power flow equations, no changes done by me. It needs to be installed with this directory and not via pip. Further information on how to install it can be found in the directory itself. 

### Pymodbus3
Pymodbus is a full Modbus protocol implementation. As two small changes were done by Chromik to the repository compared to the original pymodbus3 repository, it needs to be installed via this directory. 

### Mosaik-Web
This is a cloned version of the mosaik-web simulation framework. It contains some small adaptions done by me compared to the current official version on the github server. Therefore it is need to install mosaik-web with these files install of the server version. Further information on how to install it can be found in the directory itself. 

### Manipulation

Example files for code-attacks on the testbed. 

### Outputs 
Directory to store output files generated from the simulation.

### Topology Loader
Needed to load configuration files for the simulation, no changes done by me.
